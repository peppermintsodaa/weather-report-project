<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script type="text/javascript" src="jquery-csv.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WIL Project</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

<!--Header-->
<div class="header">
    <h1>Weather Insurances</h1>
</div>

<!--Navigation Bar-->
<div class="navigation-bar">
    <a href="HomePage.html">Home</a>
    <a href="Insurance.html">Insurance</a>
    <a href="WeatherPredictionPage.html">Weather Predictions</a>
    <a href="Roles.html">Our Roles</a>
</div>

<br>
<br>
<!--
<div class="sample-weather-prediction">
    <h1>Sample weather prediction output</h1>
    <p><b>image taken from website</b></p>
    <img src="images/weather-prediction.png" alt="Sample Weather prediction">
</div>

--> 

<!-- Main container -->
<div class="container">
    <!-- Main content area -->
    <div class="main-content">
        <h1>Weather Predictions of Suburb</h1>
        <p>Select a Date and Location Suburb in Australia to see the predicted average weather during that time and its susceptibility of a weather event.</p>

        <!-- Dropdown for months -->
        <div class="form-group">
            <label for="prediction-month">Select a Month:</label>
            <select id="prediction-month">
                <option value="January">January</option>
                <option value="February">February</option>
                <option value="March">March</option>
                <option value="April">April</option>
                <option value="May">May</option>
                <option value="June">June</option>
                <option value="July">July</option>
                <option value="August">August</option>
                <option value="September">September</option>
                <option value="October">October</option>
                <option value="November">November</option>
                <option value="December">December</option>
            </select>
        </div>

        <br>
        <!-- Input field for search -->
        <div class="form-group">
            <label for="prediction-location">Select a Suburb:</label>
            <input type="text" id="myInput" onkeyup="filterSuburbs()" 
            placeholder="Suburb..." title="Type in a suburb">
            <!-- Suburb list will appear here -->
             <ul id="myUL">
                <!-- Suburbs will be dynamically injected here -->
            </ul>
        </div>

        <br>
        <!-- Button -->
         <div class="output-button">
            <button onclick="calculateClaim()">Get Claim Amount</button>
        </div>

        <!-- Result display -->
        <div id="result">
            <p id="result-text">The predicted average weather in <u><i>suburb</i></u> in the month of <u><i>month</i></u> will be <u><i>averageTemp</i></u>&deg;C.</p><br>
            <p id="result-text">From this, <u><i>suburb</i></u> is not susceptible of a weather disaster during this month</p><br>
            <p id="result-text"> <u><i>or</i></u></p><br>
            <p class="red-text" id="result-text"><b><i>WARNING</i></b></p>
            <p class="red-text" id="result-text"><b><u><i>suburb</i></u> is susceptible of an <u><i>weather event</i></u> occurring </b></p><br>
            <p id="result-text"><b>What to do? Safety Measures:</b></p>
            <p id="result-text">.......</p>

        </div>
    </div>
</div>

<br>
<br>

<div class="footer">
    <h3>Our Website</h3> <br>
    <a href="HomePage.html">Home</a>
    <a href="Insurance.html">Insurance</a>
    <a href="WeatherPredictionPage.html">Weather Predictions</a>
    <a href="Roles.html">Our Roles</a>
</div>
</body>

<script>
    // Example suburb data (replace with your 10,000+ suburb list)
    // fetch via custom http server
    //fetch('localhost:8000/datasets/SuburbClustered.csv')
    //    .then(response => response.text())
    //    .then(data => {
    //        console.log(data);
    //    });
    async function getSuburbs(file) {
        let response = await fetch(file);
        let data = await response.text();
        let csv_final = await CSVToArray(data);
        let suburbs = await csv_final.map(e => e[0]).slice(1, -1);
        
        return suburbs
    }

    suburbs = getSuburbs('http://127.0.0.1:8000/datasets/SuburbClustered.csv');

    // ref: http://stackoverflow.com/a/1293163/2343
    // This will parse a delimited string into an array of
    // arrays. The default delimiter is the comma, but this
    // can be overriden in the second argument.
    function CSVToArray( strData, strDelimiter ){
        // Check to see if the delimiter is defined. If not,
        // then default to comma.
        strDelimiter = (strDelimiter || ",");
    
        // Create a regular expression to parse the CSV values.
        var objPattern = new RegExp(
            (
                // Delimiters.
                "(\\" + strDelimiter + "|\\r?\\n|\\r|^)" +
    
                // Quoted fields.
                "(?:\"([^\"]*(?:\"\"[^\"]*)*)\"|" +
    
                // Standard fields.
                "([^\"\\" + strDelimiter + "\\r\\n]*))"
            ),
            "gi"
            );
    
    
        // Create an array to hold our data. Give the array
        // a default empty first row.
        var arrData = [[]];
    
        // Create an array to hold our individual pattern
        // matching groups.
        var arrMatches = null;
    
    
        // Keep looping over the regular expression matches
        // until we can no longer find a match.
        while (arrMatches = objPattern.exec( strData )){
    
            // Get the delimiter that was found.
            var strMatchedDelimiter = arrMatches[ 1 ];
    
            // Check to see if the given delimiter has a length
            // (is not the start of string) and if it matches
            // field delimiter. If id does not, then we know
            // that this delimiter is a row delimiter.
            if (
                strMatchedDelimiter.length &&
                strMatchedDelimiter !== strDelimiter
                ){
    
                // Since we have reached a new row of data,
                // add an empty row to our data array.
                arrData.push( [] );
    
            }
    
            var strMatchedValue;
    
            // Now that we have our delimiter out of the way,
            // let's check to see which kind of value we
            // captured (quoted or unquoted).
            if (arrMatches[ 2 ]){
    
                // We found a quoted value. When we capture
                // this value, unescape any double quotes.
                strMatchedValue = arrMatches[ 2 ].replace(
                    new RegExp( "\"\"", "g" ),
                    "\""
                    );
    
            } else {
    
                // We found a non-quoted value.
                strMatchedValue = arrMatches[ 3 ];
    
            }
    
    
            // Now that we have our value string, let's add
            // it to the data array.
            arrData[ arrData.length - 1 ].push( strMatchedValue );
        }
    
        // Return the parsed data.
        return( arrData );
    }
    //console.log("cheese")
    //suburbss = $.csv.toArrays('datasets/SuburbClustered.csv')
    //const suburbs = [
    //  "Adaminaby", "Albury", "Alectown", "Bannaby", "Broadmeadow", "Cabramatta West", "East Ryde", 
    //  "Fawcetts Plain", "Glengarrie", "Hamilton East", "Hinton", "Jerrabomberra", "Kanangra"
    //];
    
    // Function to filter suburbs based on input
function filterSuburbs() {
  let input = document.getElementById('myInput').value.toLowerCase();
  let ul = document.getElementById("myUL");
  ul.innerHTML = ''; // Clear previous list
  
  if (input === '') {
    ul.style.display = 'none'; // Hide list if input is empty
    return;
  }

  // Filter and display suburbs that match the input
  suburbs.forEach(suburb => {
    if (suburb.toLowerCase().startsWith(input)) {
      let li = document.createElement("li");
      let a = document.createElement("a");
      a.href = "#";
      a.textContent = suburb;
      a.onclick = function() { selectSuburb(suburb); }; // Set onclick event
      li.appendChild(a);
      ul.appendChild(li);
    }
  });

  ul.style.display = ul.innerHTML === '' ? 'none' : 'block'; // Show list if there are results
}

// Function to handle selecting a suburb
function selectSuburb(suburb) {
  document.getElementById('myInput').value = suburb; // Set the input value to the selected suburb
  document.getElementById('myUL').style.display = 'none'; // Hide the list after selection
}
</script>

</html>